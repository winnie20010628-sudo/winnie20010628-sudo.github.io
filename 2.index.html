<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å·¥ä½œæ—¥èªŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            padding: 10px; 
            margin: 0; 
            background: #f0f2f5; 
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .input-area {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }
        #content {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: white;
        }
        button {
            padding: 15px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
        }
        
        /* æ¬¡è¦æŒ‰éˆ•æ¨£å¼ */
        .btn-danger {
            background: #ff3b30;
        }
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }

        .log-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .log-item {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .date-tag {
            padding: 15px;
            background: #555;
            color: white;
            font-size: 16px;
            text-align: center;
            cursor: pointer; /* å–®æ“Šç”¨æ–¼å±•é–‹/æ”¶èµ· */
            font-weight: bold;
            user-select: none;
        }
        
        /* ä½¿é›™æ“Šæ™‚çš„è¼¸å…¥æ¡†æ¨£å¼èˆ‡åŸæœ¬ä¸€è‡´ */
        .date-tag-input {
            width: 100%;
            padding: 15px;
            background: #555;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            outline: none;
            text-align: center;
            box-sizing: border-box;
        }
        
        .content-panel {
            display: none;
            padding: 20px;
            border-top: 1px solid #eee;
            flex-direction: column;
            gap: 15px;
        }
        
        .time-box {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            text-align: center;
            font-weight: bold;
            font-family: inherit;
            border: none;
            outline: none;
        }
        
        .note-box {
            flex: 1;
            padding: 15px;
            font-size: 17px;
            font-family: inherit;
            line-height: 1.6;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 120px;
            outline: none;
        }
        
        .delete-btn {
            align-self: flex-end;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æˆ‘çš„å·¥ä½œæ—¥èªŒ</h1>

        <div class="input-area">
            <textarea id="content" placeholder="è«‹è¼¸å…¥å·¥ä½œå…§å®¹..."></textarea>
            <button onclick="addRecord()">æ·»åŠ è¨˜éŒ„</button>
        </div>

        <div class="log-list" id="logList">
            <!-- æ­·å²è¨˜éŒ„æœƒåœ¨é€™è£¡è‡ªå‹•åŠ è¼‰ -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // --- å¼·åˆ¶ä¿®æ”¹ï¼šæ—¥æœŸæ ¼å¼æ”¹ç‚º å¹´-æœˆ-æ—¥ ---
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear(); // ç²å–å®Œæ•´å¹´ä»½
            // getMonth() å¾ 0 é–‹å§‹ï¼Œæ‰€ä»¥è¦ +1ï¼Œä¸¦ç¢ºä¿æ˜¯å…©ä½æ•¸
            const month = String(now.getMonth() + 1).padStart(2, '0'); 
            const day = String(now.getDate()).padStart(2, '0'); 
            
            // æ‰‹å‹•æ‹¼æ¥ç‚º å¹´-æœˆ-æ—¥
            return ${year}-${month}-${day};
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('zh-HK', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function addRecord() {
            const contentInput = document.getElementById('content');
            if (contentInput.value.trim() === '') {
                alert('è«‹å…ˆè¼¸å…¥ä¸€äº›å…§å®¹ï¼');
                return;
            }

            const record = {
                date: getCurrentDate(),
                time: getCurrentTime(),
                content: contentInput.value
            };

            addRecordToDOM(record);
            saveData();
            contentInput.value = '';
        }

        function addRecordToDOM(record) {
            const logList = document.getElementById('logList');
            
            if (logList.children.length === 1 && logList.querySelector('.no-record')) {
                logList.innerHTML = '';
            }

            const itemDiv = document.createElement('div');
            itemDiv.className = 'log-item';

            // çµæ§‹ï¼šæ—¥æœŸæ¨™ç±¤ç¶å®šå–®æ“Š(åˆ‡æ›)å’Œé›™æ“Š(ç·¨è¼¯)äº‹ä»¶
            itemDiv.innerHTML = `
                <div class="date-tag" onclick="toggleContent(this)" ondblclick="editDate(this)">
                    ${record.date}
                </div>
                <div class="content-panel">
                    <input type="text" class="time-box" value="${record.time}" ondblclick="makeEditable(this)">
                    <textarea class="note-box" rows="5" ondblclick="makeEditable(this)">${record.content}</textarea>
                    <div class="delete-btn">
                        <button class="btn-danger btn-small" onclick="deleteRecord(this)">åˆªé™¤</button>
                    </div>
                </div>
            `;

            logList.insertBefore(itemDiv, logList.firstChild);
        }

        // åˆ‡æ›å±•é–‹/æ”¶èµ· (å–®æ“Šäº‹ä»¶)
        function toggleContent(dateElement) {
            // é˜²æ­¢åœ¨ç·¨è¼¯è¼¸å…¥æ¡†æ™‚è§¸ç™¼åˆ‡æ›
            if (document.activeElement.classList.contains('date-tag-input')) {
                return;
            }
            
            const panel = dateElement.parentNode.querySelector('.content-panel');
            if (getComputedStyle(panel).display === "none") {
                panel.style.display = "flex";
            } else {
                panel.style.display = "none";
            }
        }

        // ä½¿å…ƒç´ å¯ç·¨è¼¯çš„é€šç”¨å‡½æ•¸
        function makeEditable(element) {
            // èšç„¦ä¸¦é¸æ“‡æ‰€æœ‰æ–‡æœ¬
            element.focus();
            element.select();
            
            // ç¶å®šå¤±å»ç„¦é»äº‹ä»¶ä»¥ä¿å­˜
            element.onblur = function() {
                saveData();
            };
        }

        // å°ˆé–€è™•ç†æ—¥æœŸç·¨è¼¯
        function editDate(element) {
            // é˜²æ­¢è§¸ç™¼çˆ¶ç´šçš„å–®æ“Šäº‹ä»¶ (åˆ‡æ›å±•é–‹)
            event.stopPropagation();
            
            const originalText = element.innerText;
            
            // å°‡ div ä¸´æ—¶æ›¿æ¢ä¸º input
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'date-tag-input';
            input.value = originalText;
            
            // æ›¿æ›ç¯€é»
            element.replaceWith(input);
            input.focus();
            input.select();
            
            // ç•¶å¤±å»ç„¦é»æ™‚ä¿å­˜
            function saveDate() {
                // ç§»é™¤äº‹ä»¶ç›£è½ï¼Œé˜²æ­¢é‡è¤‡è§¸ç™¼
                input.removeEventListener('blur', saveDate);
                input.removeEventListener('keydown', handleKey);
                
                const newValue = input.value.trim() || originalText; // å¦‚æœç‚ºç©ºå‰‡é‚„åŸ
                
                // å°‡ input æ›å› div
                input.replaceWith(element);
                element.innerText = newValue;
                
                saveData();
            }
            
            // ç›£è½å¤±å»ç„¦é»
            input.addEventListener('blur', saveDate);
            
            // ç›£è½æŒ‰éµ (æŒ‰ä¸‹ Enter ä¿å­˜)
            function handleKey(e) {
                if (e.key === 'Enter') {
                    saveDate();
                }
            }
            input.addEventListener('keydown', handleKey);
        }

        function deleteRecord(button) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™æ¢è¨˜éŒ„å—ï¼Ÿ')) {
                const item = button.closest('.log-item');
                item.remove();
                saveData();
            }
        }

        function saveData() {
            const logList = document.getElementById('logList');
            const items = logList.querySelectorAll('.log-item');
            
            const data = Array.from(items).map(item => {
                return {
                    date: item.querySelector('.date-tag').innerText,
                    time: item.querySelector('.time-box').value,
                    content: item.querySelector('.note-box').value
                };
            });

            localStorage.setItem('workLogData', JSON.stringify(data));
        }

        function loadData() {
            const logList = document.getElementById('logList');
            const savedData = localStorage.getItem('workLogData');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    data.forEach(record => {
                        addRecordToDOM(record);
                    });
                } catch (e) {
                    logList.innerHTML = '<div class="no-record" style="padding: 20px; color: #888; text-align: center;">è¼‰å…¥æ­·å²è¨˜éŒ„å¤±æ•—</div>';
                }
            } else {
                logList.innerHTML = '<div class="no-record" style="padding: 20px; color: #888; text-align: center;">æš«ç„¡è¨˜éŒ„</div>';
            }
        }
    </script>
</body>
</html>
