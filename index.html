<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å·¥ä½œæ—¥èªŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            padding: 10px; 
            margin: 0; 
            background: #f0f2f5; 
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .input-area {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }
        #content {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: white;
        }
        button {
            padding: 15px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
        }
        
        /* æ¬¡è¦æŒ‰éˆ•æ¨£å¼ */
        .btn-danger {
            background: #ff3b30;
        }
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }

        .log-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .log-item {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .date-tag {
            padding: 15px;
            background: #555;
            color: white;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        
        .date-tag-input {
            width: 100%;
            padding: 15px;
            background: #555;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            outline: none;
            text-align: center;
            box-sizing: border-box;
        }
        
        .content-panel {
            display: none;
            padding: 20px;
            border-top: 1px solid #eee;
            flex-direction: column;
            gap: 15px;
        }
        
        .time-box {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            text-align: center;
            font-weight: bold;
            font-family: inherit;
            border: none;
            outline: none;
        }
        
        .note-box {
            flex: 1;
            padding: 15px;
            font-size: 17px;
            font-family: inherit;
            line-height: 1.6;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 120px;
            outline: none;
        }
        
        .delete-btn {
            align-self: flex-end;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æˆ‘çš„å·¥ä½œæ—¥èªŒ</h1>

        <div class="input-area">
            <textarea id="content" placeholder="è«‹è¼¸å…¥å·¥ä½œå…§å®¹..."></textarea>
            <button onclick="addRecord()">æ·»åŠ è¨˜éŒ„</button>
        </div>

        <div class="log-list" id="logList">
            <!-- æ­·å²è¨˜éŒ„æœƒåœ¨é€™è£¡è‡ªå‹•åŠ è¼‰ -->
        </div>
    </div>

    <script>
        // DOMContentLoaded äº‹ä»¶ç¢ºä¿é é¢åŠ è¼‰å®Œæˆå¾Œå†åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // ä½¿ç”¨ try-catch åŒ…è£¹ï¼Œé˜²æ­¢ localStorage æŠ¥é”™å¯¼è‡´è„šæœ¬åœæ­¢
            try {
                loadData();
            } catch (e) {
                console.error("è¼‰å…¥æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:", e);
                document.getElementById('logList').innerHTML = '<div style="padding: 20px; color: #d00;">ç„¡æ³•è¼‰å…¥æ•¸æ“š (å¯èƒ½æ˜¯ç€è¦½å™¨éš±ç§è¨­ç½®é™åˆ¶)ã€‚</div>';
            }
        });

        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0'); 
            const day = String(now.getDate()).padStart(2, '0'); 
            return ${year}-${month}-${day};
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('zh-HK', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function addRecord() {
            const contentInput = document.getElementById('content');
            if (contentInput.value.trim() === '') {
                alert('è«‹å…ˆè¼¸å…¥ä¸€äº›å…§å®¹ï¼');
                return;
            }

            const record = {
                date: getCurrentDate(),
                time: getCurrentTime(),
                content: contentInput.value
            };

            // ç¡®ä¿ addRecordToDOM å‡½æ•°å­˜åœ¨
            addRecordToDOM(record);
            
            // ä¿å­˜æ•°æ®
            try {
                saveData();
            } catch (e) {
                console.error("ä¿å­˜æ•¸æ“šå¤±æ•—:", e);
            }
            
            contentInput.value = '';
        }

        function addRecordToDOM(record) {
            const logList = document.getElementById('logList');
            
            // æ¸…é™¤é»˜è®¤çš„â€œæš‚æ— è®°å½•â€æç¤º
            if (logList.children.length === 1 && logList.querySelector('.no-record')) {
                logList.innerHTML = '';
            }

            const itemDiv = document.createElement('div');
            itemDiv.className = 'log-item';

            itemDiv.innerHTML = `
                <div class="date-tag" onclick="toggleContent(this)" ondblclick="editDate(this)">
                    ${record.date}
                </div>
                <div class="content-panel">
                    <input type="text" class="time-box" value="${record.time}" ondblclick="makeEditable(this)">
                    <textarea class="note-box" rows="5" ondblclick="makeEditable(this)">${record.content}</textarea>
                    <div class="delete-btn">
                        <button class="btn-danger btn-small" onclick="deleteRecord(this)">åˆªé™¤</button>
                    </div>
                </div>
            `;

            logList.insertBefore(itemDiv, logList.firstChild);
        }

        function toggleContent(dateElement) {
            if (document.activeElement.classList && document.activeElement.classList.contains('date-tag-input')) {
                return;
            }
            const panel = dateElement.parentNode.querySelector('.content-panel');
            panel.style.display = panel.style.display === "flex" ? "none" : "flex";
        }

        function makeEditable(element) {
            element.focus();
            element.select();
            element.onblur = function() {
                // å°è¯•ä¿å­˜ï¼Œå³ä½¿å¤±è´¥ä¹Ÿä¸ä¸­æ–­
                try { saveData(); } catch (e) {}
            };
        }

        function editDate(element) {
            event.stopPropagation();
            const originalText = element.innerText;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'date-tag-input';
            input.value = originalText;

            element.replaceWith(input);
            input.focus();
            input.select();

            function saveDate() {
                input.removeEventListener('blur', saveDate);
                const newValue = input.value.trim() || originalText;
                input.replaceWith(element);
                element.innerText = newValue;
                try { saveData(); } catch (e) {}
            }

            input.addEventListener('blur', saveDate);
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') saveDate();
            });
        }

        function deleteRecord(button) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™æ¢è¨˜éŒ„å—ï¼Ÿ')) {
                const item = button.closest('.log-item');
                item.remove();
                try { saveData(); } catch (e) {}
            }
        }

        // --- æ ¸å¿ƒä¿®æ”¹é»ï¼šå¢åŠ  try-catch é˜²æ­¢ localStorage æŠ¥é”™ ---
        function saveData() {
            try {
                const logList = document.getElementById('logList');
                const items = logList.querySelectorAll('.log-item');
                
                const data = Array.from(items).map(item => {
                    return {
                        date: item.querySelector('.date-tag').innerText,
                        time: item.querySelector('.time-box').value,
                        content: item.querySelector('.note-box').value
                    };
                });

                // å°è¯•å†™å…¥ localStorage
                localStorage.setItem('workLogData', JSON.stringify(data));
            } catch (e) {
                console.warn("ç„¡æ³•ä¿å­˜åˆ° localStorage:", e);
                // è¿™é‡Œå¯ä»¥æ·»åŠ å¤‡ç”¨æ–¹æ¡ˆï¼Œæ¯”å¦‚æç¤ºç”¨æˆ·
            }
        }

        function loadData() {
            try {
                const logList = document.getElementById('logList');
                // å°è¯•è¯»å–
                const savedData = localStorage.getItem('workLogData');
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    data.forEach(record => {
                        addRecordToDOM(record);
                    });
                } else {
                    logList.innerHTML = '<div class="no-record" style="padding: 20px; color: #888; text-align: center;">æš«ç„¡è¨˜éŒ„</div>';
                }
            } catch (e) {
                console.error("è¼‰å…¥æ•¸æ“šå¤±æ•—:", e);
                document.getElementById('logList').innerHTML = '<div style="padding: 20px; color: #d00;">æ•¸æ“šè¼‰å…¥å¤±æ•—ã€‚</div>';
            }
        }
    </script>
</body>
</html>
