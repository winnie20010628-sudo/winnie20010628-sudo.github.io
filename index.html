<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å·¥ä½œæ—¥èªŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            padding: 10px; 
            margin: 0; 
            background: #f0f2f5; 
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .input-area {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }
        #content {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: white;
        }
        button {
            padding: 15px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
        }
        
        .btn-danger {
            background: #ff3b30;
        }
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }

        .log-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .log-item {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .date-tag {
            padding: 15px;
            background: #555;
            color: white;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        
        .date-tag-input {
            width: 100%;
            padding: 15px;
            background: #555;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            outline: none;
            text-align: center;
            box-sizing: border-box;
        }
        
        .content-panel {
            display: none;
            padding: 20px;
            border-top: 1px solid #eee;
            flex-direction: column;
            gap: 15px;
        }
        
        .time-box {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            text-align: center;
            font-weight: bold;
            font-family: inherit;
            border: none;
            outline: none;
        }
        
        .note-box {
            flex: 1;
            padding: 15px;
            font-size: 17px;
            font-family: inherit;
            line-height: 1.6;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 120px;
            outline: none;
        }
        
        .delete-btn {
            align-self: flex-end;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æˆ‘çš„å·¥ä½œæ—¥èªŒ</h1>

        <div class="input-area">
            <textarea id="content" placeholder="è«‹è¼¸å…¥å·¥ä½œå…§å®¹..."></textarea>
            <button id="addBtn">æ·»åŠ è¨˜éŒ„</button>
        </div>

        <div class="log-list" id="logList">
            <!-- æ­·å²è¨˜éŒ„æœƒåœ¨é€™è£¡è‡ªå‹•åŠ è¼‰ -->
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let logData = [];
        
        // DOMåŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        function initApp() {
            // è¨­ç½®æŒ‰éˆ•äº‹ä»¶ç›£è½å™¨
            document.getElementById('addBtn').addEventListener('click', addRecord);
            
            // åŠ è¼‰æ•¸æ“š
            loadData();
        }
        
        // --- å·¥å…·å‡½æ•¸ ---
        function showError(msg) {
            const logList = document.getElementById('logList');
            logList.innerHTML = '<div style="color: red; padding: 10px;">' + msg + '</div>';
        }
        
        // --- æ•¸æ“šç›¸é—œ ---
        function saveData() {
            try {
                const logList = document.getElementById('logList');
                const items = logList.querySelectorAll('.log-item');
                
                if (items.length === 0) {
                    localStorage.setItem('workLogData', '[]');
                    return;
                }
                
                const data = Array.from(items).map(item => {
                    return {
                        date: item.querySelector('.date-tag').innerText,
                        time: item.querySelector('.time-box').value,
                        content: item.querySelector('.note-box').value
                    };
                });
                
                localStorage.setItem('workLogData', JSON.stringify(data));
            } catch (e) {
                console.warn("æ•¸æ“šä¿å­˜å¤±æ•—:", e);
            }
        }
        
        function loadData() {
            try {
                const logList = document.getElementById('logList');
                const savedData = localStorage.getItem('workLogData');
                
                if (!savedData || savedData === 'undefined' || savedData === 'null') {
                    logList.innerHTML = '<div class="no-record" style="padding: 20px; color: #888; text-align: center;">æš«ç„¡è¨˜éŒ„ï¼Œè«‹æ·»åŠ ä¸€æ¢æ–°è¨˜éŒ„å§ï¼</div>';
                    return;
                }
                
                const data = JSON.parse(savedData);
                
                if (data.length === 0) {
                    logList.innerHTML = '<div class="no-record" style="padding: 20px; color: #888; text-align: center;">æš«ç„¡è¨˜éŒ„</div>';
                } else {
                    // åè½‰æ•¸çµ„ï¼Œæœ€æ–°çš„é¡¯ç¤ºåœ¨æœ€ä¸Šé¢
                    data.slice().reverse().forEach(record => {
                        addRecordToDOM(record);
                    });
                }
            } catch (e) {
                console.error("æ•¸æ“šåŠ è¼‰å¤±æ•—:", e);
                showError("æ•¸æ“šåŠ è¼‰å¤±æ•—ï¼Œå¯èƒ½æ˜¯æ ¼å¼éŒ¯èª¤ã€‚");
            }
        }
        
        // --- æ¥­å‹™é‚è¼¯ ---
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0'); 
            const day = String(now.getDate()).padStart(2, '0'); 
            return year + '-' + month + '-' + day;
        }
        
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('zh-HK', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }
        
        function addRecord() {
            const contentInput = document.getElementById('content');
            if (!contentInput || contentInput.value.trim() === '') {
                alert('è«‹å…ˆè¼¸å…¥ä¸€äº›å…§å®¹ï¼');
                return;
            }
            
            const record = {
                date: getCurrentDate(),
                time: getCurrentTime(),
                content: contentInput.value.trim()
            };
            
            addRecordToDOM(record);
            contentInput.value = '';
            saveData();
        }
        
        function addRecordToDOM(record) {
            const logList = document.getElementById('logList');
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¢è¨˜éŒ„ä¸”å­˜åœ¨æç¤ºæ–‡å­—ï¼Œå…ˆæ¸…é™¤
            const firstChild = logList.firstElementChild;
            if (firstChild && firstChild.classList && firstChild.classList.contains('no-record')) {
                logList.innerHTML = '';
            }
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'log-item';
            
            itemDiv.innerHTML = `
                <div class="date-tag" onclick="toggleContent(this)" ondblclick="editDate(this)">
                    ${record.date}
                </div>
                <div class="content-panel">
                    <input type="text" class="time-box" value="${record.time}" ondblclick="makeEditable(this)">
                    <textarea class="note-box" rows="5" ondblclick="makeEditable(this)">${record.content}</textarea>
                    <div class="delete-btn">
                        <button class="btn-danger btn-small" onclick="deleteRecord(this)">åˆªé™¤</button>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°åˆ—è¡¨é ‚éƒ¨ï¼ˆæœ€æ–°è¨˜éŒ„åœ¨ä¸Šé¢ï¼‰
            logList.insertBefore(itemDiv, logList.firstChild);
        }
        
        // --- å…¨å±€å‡½æ•¸ï¼ˆç”¨æ–¼HTML onclickï¼‰---
        function toggleContent(dateElement) {
            if (!dateElement) return;
            
            // é˜²æ­¢åœ¨ç·¨è¼¯ç‹€æ…‹ä¸‹è§¸ç™¼
            if (document.activeElement && document.activeElement.classList && 
                document.activeElement.classList.contains('date-tag-input')) {
                return;
            }
            
            const panel = dateElement.parentNode.querySelector('.content-panel');
            if (panel) {
                panel.style.display = panel.style.display === "flex" ? "none" : "flex";
            }
        }
        
        function makeEditable(element) {
            if (element) {
                element.focus();
                element.select();
                element.onblur = function() {
                    saveData();
                };
            }
        }
        
        function editDate(element) {
            if (!element) return;
            
            // åœæ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢è§¸ç™¼toggleContent
            if (event) {
                event.stopPropagation();
            }
            
            const originalText = element.innerText;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'date-tag-input';
            input.value = originalText;
            
            element.replaceWith(input);
            input.focus();
            input.select();
            
            function saveDate() {
                input.removeEventListener('blur', saveDate);
                input.removeEventListener('keydown', handleKey);
                
                const newValue = input.value.trim() || originalText;
                input.replaceWith(element);
                element.innerText = newValue;
                saveData();
            }
            
            function handleKey(e) {
                if (e.key === 'Enter') {
                    saveDate();
                }
            }
            
            input.addEventListener('blur', saveDate);
            input.addEventListener('keydown', handleKey);
        }
        
        function deleteRecord(button) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™æ¢è¨˜éŒ„å—ï¼Ÿ')) {
                const item = button.closest('.log-item');
                if (item) {
                    item.remove();
                    saveData();
                }
            }
        }
    </script>
</body>
</html>
